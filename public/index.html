<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…ÙˆÙ‚Ø¹ Ø¨ÙŠØ¹ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„ÙˆÙ‡Ù…ÙŠØ©</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; direction: rtl; text-align: right; }
        .container { max-width: 600px; margin: 0 auto; padding: 20px; border: 1px solid #ccc; border-radius: 8px; margin-bottom: 15px;}
        label, select, button { display: block; margin-bottom: 10px; width: 100%; }
        button { padding: 10px; background-color: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:disabled { background-color: #ccc; cursor: not-allowed; }
        .result { margin-top: 20px; padding: 15px; border: 1px solid #ddd; border-radius: 4px; background-color: #f9f9f9; }
        #blacklist-btn { background-color: #dc3545; margin-top: 5px; } 
        #history-display { border-top: 1px solid #ccc; padding-top: 10px; }
        .balance-box { background-color: #e9ecef; border: 1px solid #ddd; padding: 10px; border-radius: 4px; }
    </style>
</head>
<body>

    <div class="container balance-box">
        <h2>ğŸ’³ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨</h2>
        <p><strong>Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:</strong> <span id="user-id-display">...</span></p>
        <p><strong>Ø±ØµÙŠØ¯Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠ:</strong> <span id="current-balance">--.--</span> ÙˆØ­Ø¯Ø©</p>
        <button onclick="fetchHistory()">Ø¹Ø±Ø¶/Ø¥Ø®ÙØ§Ø¡ Ø³Ø¬Ù„ Ø§Ù„Ø´Ø±Ø§Ø¡</button>
        <button onclick="logout()" style="background-color: #6c757d; margin-top: 10px;">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>

        <div style="margin-top: 15px; padding-top: 10px; border-top: 1px dashed #ccc;">
            <h4>ğŸ’° Ø´Ø­Ù† Ø§Ù„Ø±ØµÙŠØ¯ (Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±)</h4>
            <label for="credit-amount">Ø£Ø¯Ø®Ù„ Ø§Ù„Ù…Ø¨Ù„Øº Ù„Ù„Ø´Ø­Ù†:</label>
            <input type="number" id="credit-amount" min="1" step="any" placeholder="Ø§Ù„Ù…Ø¨Ù„Øº (Ù…Ø«Ø§Ù„: 5.00)" style="width: 95%;">
            <button onclick="addCredit()" style="background-color: #28a745;">Ø¥Ø¶Ø§ÙØ© Ø±ØµÙŠØ¯</button>
            <p id="credit-message" style="font-size: 0.9em;"></p>
        </div>
        
        <div id="history-display" style="max-height: 250px; overflow-y: scroll; margin-top: 10px; display: none;">
            </div>
    </div>

    <div class="container">
        <h1>ğŸ”¢ Ø·Ù„Ø¨ Ø±Ù‚Ù… ÙˆÙ‡Ù…ÙŠ Ø¬Ø¯ÙŠØ¯</h1>
        
        <label for="country-select">Ø§Ø®ØªØ± Ø§Ù„Ø¯ÙˆÙ„Ø©:</label>
        <select id="country-select">
            <option value="">... Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù…ÙŠÙ„ ...</option>
        </select>

        <label for="service-select">Ø§Ø®ØªØ± Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ (PID):</label>
        <select id="service-select">
            <option value="0528">ÙˆØ§ØªØ³Ø§Ø¨</option>
            <option value="0257">ØªÙŠÙ„Ø¬Ø±Ø§Ù…</option>
            <option value="0013">ÙÙŠØ³Ø¨ÙˆÙƒ</option>
            </select>
        
        <button onclick="requestNumber()">Ø·Ù„Ø¨ Ø±Ù‚Ù… Ø¬Ø¯ÙŠØ¯</button>

        <div id="result-display" class="result">
            <p><strong>Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨:</strong> <span id="status">ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø·Ù„Ø¨...</span></p>
            <p><strong>Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø°ÙŠ ØªÙ… Ø·Ù„Ø¨Ù‡:</strong> <span id="phone-number"></span></p>
            <p><strong>Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ù…Ø³ØªÙ„Ù…:</strong> <span id="verification-code"></span></p>
        </div>

        <button id="check-code-btn" onclick="checkCode()" disabled>Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ÙƒÙˆØ¯</button>
        <button id="blacklist-btn" onclick="addBlacklist()" disabled>Ø­Ø¸Ø± Ø§Ù„Ø±Ù‚Ù… (Blacklist)</button>
        
        <p id="message"></p>
    </div>

    <div class="container" style="margin-top: 25px; background-color: #ffe0b2; border: 1px solid #ff9800;">
        <h2>ğŸ‘‘ Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ (Admin Panel)</h2>
        <p style="color: #ff0000;">âš ï¸ Ø§Ø³ØªØ®Ø¯Ù… Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù… Ø¨Ø­Ø°Ø± Ø´Ø¯ÙŠØ¯.</p>

        <label for="admin-key-input">Ù…ÙØªØ§Ø­ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ Ø§Ù„Ø³Ø±ÙŠ:</label>
        <input type="password" id="admin-key-input" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ù…ÙØªØ§Ø­ Ø§Ù„Ø³Ø±ÙŠ" style="width: 95%;">

        <label for="target-user-id">Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù…Ø³ØªÙ‡Ø¯Ù (Target User ID):</label>
        <input type="text" id="target-user-id" placeholder="ID Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø°ÙŠ ØªØ±ÙŠØ¯ Ø´Ø­Ù†Ù‡" style="width: 95%;">

        <label for="admin-credit-amount">Ù…Ø¨Ù„Øº Ø§Ù„Ø¥Ø¶Ø§ÙØ©:</label>
        <input type="number" id="admin-credit-amount" min="0.01" step="any" placeholder="Ø§Ù„Ù…Ø¨Ù„Øº (Ù…Ø«Ø§Ù„: 50.00)" style="width: 95%;">
        
        <button onclick="adminAddCredit()" style="background-color: #ff9800;">Ø¥Ø¶Ø§ÙØ© Ø±ØµÙŠØ¯ ÙƒÙ…Ø³Ø¤ÙˆÙ„</button>
        <p id="admin-message" style="font-size: 0.9em; margin-top: 10px;"></p>
    </div>


    <script>
        // ğŸ“š ØªÙˆØ«ÙŠÙ‚: Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠØ©
        let currentPhoneNumber = null; 
        let currentPid = null; 
        let currentUserId = null; 

        // ğŸ”‘ ØªÙˆØ«ÙŠÙ‚: Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        function checkAuthentication() {
            const storedUserId = localStorage.getItem('currentUserId');
            if (storedUserId) {
                currentUserId = storedUserId;
                document.getElementById('user-id-display').textContent = currentUserId; 
                fetchBalance(); 
                fetchCountries();
            } else {
                // âš ï¸ ØªÙˆØ¬ÙŠÙ‡ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¥Ù„Ù‰ ØµÙØ­Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù‡Ù†Ø§Ùƒ Ù…Ø¹Ø±Ù Ù…Ø³ØªØ®Ø¯Ù…
                alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹.');
                window.location.href = 'login.html';
            }
        }

        // â¡ï¸ ØªÙˆØ«ÙŠÙ‚: Ø¯Ø§Ù„Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
        function logout() {
            localStorage.removeItem('currentUserId');
            localStorage.removeItem('currentUserBalance');
            window.location.href = 'login.html';
        }

        // â¡ï¸ ØªÙˆØ«ÙŠÙ‚: Ø¬Ù„Ø¨ ÙˆØªØ­Ø¯ÙŠØ« Ø§Ù„Ø±ØµÙŠØ¯
        async function fetchBalance() {
            if (!currentUserId) return;
            try {
                const response = await fetch(`/api/balance/${currentUserId}`);
                const data = await response.json();
                if (data.success) {
                    document.getElementById('current-balance').textContent = data.balance.toFixed(2);
                }
            } catch (error) {
                console.error('ÙØ´Ù„ Ø¬Ù„Ø¨ Ø§Ù„Ø±ØµÙŠØ¯:', error);
            }
        }

        // â¡ï¸ ØªÙˆØ«ÙŠÙ‚: Ø¬Ù„Ø¨ ÙˆØ¹Ø±Ø¶ Ø³Ø¬Ù„ Ø§Ù„Ø´Ø±Ø§Ø¡
        async function fetchHistory() {
            if (!currentUserId) return;

            const historyDiv = document.getElementById('history-display');
            if (historyDiv.style.display === 'block') {
                historyDiv.style.display = 'none';
                return;
            }
            historyDiv.style.display = 'block';
            historyDiv.innerHTML = '<p>Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³Ø¬Ù„...</p>';

            try {
                const response = await fetch(`/api/history/${currentUserId}`);
                const data = await response.json();
                
                if (data.success && data.history.length > 0) {
                    historyDiv.innerHTML = '<h4>Ø¢Ø®Ø± Ø§Ù„Ø·Ù„Ø¨Ø§Øª:</h4>';
                    data.history.forEach(order => {
                        const statusText = order.status === 'RECEIVED_CODE' ? 'âœ… ØªÙ… Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…' : 
                                           order.status === 'BLACKLISTED' ? 'ğŸš« Ù…Ø­Ø¸ÙˆØ±' : 'â³ Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„ÙƒÙˆØ¯';
                        
                        historyDiv.innerHTML += `<p style="border-bottom: 1px dotted #ccc; padding-bottom: 5px; font-size: 0.9em;">
                            **${order.phoneNumber}** - (${order.country})<br>
                            Ø§Ù„Ø­Ø§Ù„Ø©: ${statusText} | Ø§Ù„ÙƒÙ„ÙØ©: ${order.cost.toFixed(2)} | ÙÙŠ: ${new Date(order.createdAt).toLocaleDateString()}
                        </p>`;
                    });
                } else {
                    historyDiv.innerHTML = '<p>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø³Ø¬Ù„ Ø´Ø±Ø§Ø¡ Ø­Ø§Ù„ÙŠØ§Ù‹.</p>';
                }
            } catch (error) {
                console.error('ÙØ´Ù„ Ø¬Ù„Ø¨ Ø§Ù„Ø³Ø¬Ù„:', error);
                historyDiv.innerHTML = '<p>Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø³Ø¬Ù„.</p>';
            }
        }

        // â¡ï¸ ØªÙˆØ«ÙŠÙ‚: Ø¬Ù„Ø¨ Ø§Ù„Ø¯ÙˆÙ„ Ø§Ù„Ù…ØªØ§Ø­Ø©
        async function fetchCountries() {
            try {
                const response = await fetch('/api/countries');
                const data = await response.json();
                const select = document.getElementById('country-select');
                select.innerHTML = ''; 

                if (data.success && data.countries) {
                    select.add(new Option('--- Ø§Ø®ØªØ± Ø¯ÙˆÙ„Ø© ---', ''));
                    for (const [countryCode, count] of Object.entries(data.countries)) {
                        select.add(new Option(`${countryCode.toUpperCase()} (${count} Ù…ØªÙˆÙØ±)`, countryCode));
                    }
                } else {
                    select.add(new Option('ÙØ´Ù„ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¯ÙˆÙ„', ''));
                }
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¯ÙˆÙ„:', error);
            }
        }

        // â¡ï¸ ØªÙˆØ«ÙŠÙ‚: Ø·Ù„Ø¨ Ø±Ù‚Ù… Ø¬Ø¯ÙŠØ¯
        async function requestNumber() {
            const country = document.getElementById('country-select').value;
            const pid = document.getElementById('service-select').value; 

            if (!country || !pid) {
                alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¯ÙˆÙ„Ø© ÙˆØ§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø£ÙˆÙ„Ø§Ù‹.');
                return;
            }
            if (!currentUserId) {
                alert('ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„.');
                return;
            }

            currentPid = pid; 
            document.getElementById('status').textContent = 'Ø¬Ø§Ø±Ù Ø·Ù„Ø¨ Ø§Ù„Ø±Ù‚Ù…...';
            document.getElementById('phone-number').textContent = '';
            document.getElementById('verification-code').textContent = '';
            document.getElementById('check-code-btn').disabled = true;
            document.getElementById('blacklist-btn').disabled = true;
            document.getElementById('message').textContent = '';

            try {
                const response = await fetch('/api/request-number', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ country: country, pid: currentPid, userId: currentUserId }) 
                });

                const data = await response.json();
                
                if (data.success) {
                    currentPhoneNumber = data.number;
                    document.getElementById('status').textContent = 'ØªÙ… Ø·Ù„Ø¨ Ø§Ù„Ø±Ù‚Ù… Ø¨Ù†Ø¬Ø§Ø­.';
                    document.getElementById('phone-number').textContent = currentPhoneNumber;
                    document.getElementById('check-code-btn').disabled = false;
                    document.getElementById('blacklist-btn').disabled = false; 
                    document.getElementById('message').textContent = 'Ø¶Ø¹ Ø§Ù„Ø±Ù‚Ù… ÙˆØ§Ø¶ØºØ· "Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ÙƒÙˆØ¯" Ø£Ùˆ "Ø­Ø¸Ø± Ø§Ù„Ø±Ù‚Ù…".';
                    fetchBalance(); 
                } else {
                    document.getElementById('status').textContent = 'ÙØ´Ù„ Ø§Ù„Ø·Ù„Ø¨.';
                    document.getElementById('phone-number').textContent = data.message || 'Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø±Ù‚Ù….';
                }
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø·Ù„Ø¨ Ø§Ù„Ø±Ù‚Ù…:', error);
                document.getElementById('status').textContent = 'Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù….';
            }
        }

        // â¡ï¸ ØªÙˆØ«ÙŠÙ‚: Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØµÙˆÙ„ Ø§Ù„ÙƒÙˆØ¯
        async function checkCode() {
            if (!currentPhoneNumber || !currentPid || !currentUserId) {
                alert('Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø·Ù„Ø¨ ØºÙŠØ± ÙƒØ§Ù…Ù„Ø©.');
                return;
            }

            document.getElementById('status').textContent = 'Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ÙƒÙˆØ¯...';
            document.getElementById('message').textContent = 'Ù‚Ø¯ ÙŠØ³ØªØºØ±Ù‚ Ø§Ù„Ø£Ù…Ø± Ø¨Ø¶Ø¹ Ø«ÙˆØ§Ù†Ù.';

            try {
                const response = await fetch(`/api/get-code?pn=${currentPhoneNumber}&pid=${currentPid}&userId=${currentUserId}`);
                const data = await response.json();
                
                if (data.success && data.code) {
                    document.getElementById('status').textContent = 'âœ… ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„ÙƒÙˆØ¯ Ø¨Ù†Ø¬Ø§Ø­.';
                    document.getElementById('verification-code').textContent = data.code;
                    document.getElementById('message').textContent = 'ØªÙ… Ø®ØµÙ… Ø§Ù„Ø±ØµÙŠØ¯ Ø¨Ù†Ø¬Ø§Ø­. ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø¢Ù†.';
                    document.getElementById('check-code-btn').disabled = true; 
                    document.getElementById('blacklist-btn').disabled = true;
                    fetchBalance();
                } else {
                    document.getElementById('status').textContent = 'Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±.';
                    document.getElementById('verification-code').textContent = 'Ù„Ù… ÙŠØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„ÙƒÙˆØ¯ Ø¨Ø¹Ø¯. Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.';
                }
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„ÙƒÙˆØ¯:', error);
                document.getElementById('status').textContent = 'Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù….';
            }
        }

        // â¡ï¸ ØªÙˆØ«ÙŠÙ‚: Ø¥Ø¶Ø§ÙØ© Ø¯Ø§Ù„Ø© Ù„Ø­Ø¸Ø± Ø§Ù„Ø±Ù‚Ù…
        async function addBlacklist() {
            if (!currentPhoneNumber || !currentPid || !currentUserId) {
                alert('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø±Ù‚Ù… Ù†Ø´Ø· Ù„Ø­Ø¸Ø±Ù‡.');
                return;
            }

            if (!confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø¸Ø± Ø§Ù„Ø±Ù‚Ù… ${currentPhoneNumber}ØŸ`)) {
                return;
            }

            document.getElementById('status').textContent = 'Ø¬Ø§Ø±Ù Ø­Ø¸Ø± Ø§Ù„Ø±Ù‚Ù…...';
            document.getElementById('blacklist-btn').disabled = true;
            document.getElementById('check-code-btn').disabled = true;
            
            try {
                const response = await fetch('/api/add-blacklist', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ pn: currentPhoneNumber, pid: currentPid, userId: currentUserId }) 
                });

                const data = await response.json();
                
                if (data.success) {
                    document.getElementById('status').textContent = 'ğŸš« ØªÙ… Ø­Ø¸Ø± Ø§Ù„Ø±Ù‚Ù… Ø¨Ù†Ø¬Ø§Ø­.';
                    document.getElementById('message').textContent = 'Ø§Ù„Ø±Ù‚Ù… Ù…Ø­Ø¸ÙˆØ± Ø§Ù„Ø¢Ù†. ÙŠÙ…ÙƒÙ†Ùƒ Ø·Ù„Ø¨ Ø±Ù‚Ù… Ø¬Ø¯ÙŠØ¯.';
                    currentPhoneNumber = null; 
                    currentPid = null;
                } else {
                    document.getElementById('status').textContent = 'ÙØ´Ù„ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø­Ø¸Ø±.';
                    document.getElementById('message').textContent = data.message || 'Ø­Ø¯Ø« Ø®Ø·Ø£ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­Ø¸Ø±.';
                    document.getElementById('blacklist-btn').disabled = false; 
                    document.getElementById('check-code-btn').disabled = false;
                }
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø­Ø¸Ø±:', error);
                document.getElementById('status').textContent = 'Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù… Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­Ø¸Ø±.';
            }
        }

        // â¡ï¸ ØªÙˆØ«ÙŠÙ‚: (10) - Ø¯Ø§Ù„Ø© Ù„Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø´Ø­Ù† Ø§Ù„Ø±ØµÙŠØ¯ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¹Ø§Ø¯ÙŠ
        async function addCredit() {
            if (!currentUserId) {
                alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹.');
                return;
            }

            const amountInput = document.getElementById('credit-amount');
            const amount = amountInput.value;
            const creditMessage = document.getElementById('credit-message');

            if (!amount || parseFloat(amount) <= 0) {
                creditMessage.textContent = 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ù…Ø¨Ù„Øº ØµØ­ÙŠØ­.';
                creditMessage.style.color = '#dc3545';
                return;
            }
            
            creditMessage.textContent = 'Ø¬Ø§Ø±Ù Ù…Ø¹Ø§Ù„Ø¬Ø© Ø·Ù„Ø¨ Ø§Ù„Ø´Ø­Ù†...';
            creditMessage.style.color = '#007bff';
            
            try {
                const response = await fetch('/api/add-credit', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ userId: currentUserId, amount: amount })
                });

                const data = await response.json();
                
                if (data.success) {
                    creditMessage.textContent = data.message;
                    creditMessage.style.color = '#28a745';
                    amountInput.value = ''; 
                    fetchBalance(); 
                } else {
                    creditMessage.textContent = data.message;
                    creditMessage.style.color = '#dc3545';
                }

            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø´Ø­Ù† Ø§Ù„Ø±ØµÙŠØ¯:', error);
                creditMessage.textContent = 'ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù… Ù„Ø¥ØªÙ…Ø§Ù… Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø´Ø­Ù†.';
                creditMessage.style.color = '#dc3545';
            }
        }
        
        // â¡ï¸ ØªÙˆØ«ÙŠÙ‚: (11) - Ø¯Ø§Ù„Ø© Ù„Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø´Ø­Ù† Ø§Ù„Ø±ØµÙŠØ¯ Ù„Ù„Ù…Ø³Ø¤ÙˆÙ„
        async function adminAddCredit() {
            const adminKey = document.getElementById('admin-key-input').value;
            const targetUserId = document.getElementById('target-user-id').value;
            const amount = document.getElementById('admin-credit-amount').value;
            const adminMessage = document.getElementById('admin-message');

            if (!adminKey || !targetUserId || parseFloat(amount) <= 0) {
                adminMessage.textContent = 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­.';
                adminMessage.style.color = '#dc3545';
                return;
            }

            adminMessage.textContent = 'Ø¬Ø§Ø±Ù Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø±ØµÙŠØ¯ ÙƒÙ…Ø³Ø¤ÙˆÙ„...';
            adminMessage.style.color = '#ff9800';

            try {
                const response = await fetch('/api/admin/add-credit', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ targetUserId: targetUserId, amount: amount, adminKey: adminKey })
                });

                const data = await response.json();
                
                if (data.success) {
                    adminMessage.textContent = data.message + ` Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ø¬Ø¯ÙŠØ¯: ${data.newBalance.toFixed(2)}`;
                    adminMessage.style.color = '#28a745';
                    
                    if (targetUserId === currentUserId) {
                        fetchBalance();
                    }

                } else {
                    adminMessage.textContent = data.message || 'ÙØ´Ù„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©.';
                    adminMessage.style.color = '#dc3545';
                }

            } catch (error) {
                console.error('Ø®Ø·Ø£ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ ÙÙŠ Ø´Ø­Ù† Ø§Ù„Ø±ØµÙŠØ¯:', error);
                adminMessage.textContent = 'ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù… Ù„Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø±ØµÙŠØ¯.';
                adminMessage.style.color = '#dc3545';
            }
        }

        // ğŸ“š ØªÙˆØ«ÙŠÙ‚: ØªØ´ØºÙŠÙ„ ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ ÙˆØ¬Ù„Ø¨ Ø§Ù„Ø¯ÙˆÙ„ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        window.onload = checkAuthentication;

    </script>
</body>
</html>
